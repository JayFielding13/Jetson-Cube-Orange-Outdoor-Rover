===============================================================================
RASPBERRY PI SETUP GUIDE FOR ROVER PROJECT
===============================================================================

HARDWARE REQUIREMENTS:
- Raspberry Pi 4 (4GB) with Raspberry Pi OS
- MicroSD card (32GB+ recommended)
- DROK DC Motor Driver
- Two DC motors with encoders
- Arduino Nano (connected via USB)
- Two TP-Link UB500 Bluetooth dongles
- 5V/5A buck converter power supply

SOFTWARE REQUIREMENTS:
- Python 3.7 or newer (pre-installed on Pi OS)
- pip package manager
- Git (for version control)

INSTALLATION STEPS:

1. RASPBERRY PI OS SETUP:
   - Flash latest Raspberry Pi OS to SD card
   - Enable SSH if needed: sudo systemctl enable ssh
   - Update system: sudo apt update && sudo apt upgrade -y

2. INSTALL SYSTEM DEPENDENCIES:
   sudo apt install -y python3-pip python3-venv git
   sudo apt install -y bluetooth bluez libbluetooth-dev
   sudo apt install -y python3-dev python3-setuptools

3. CREATE PROJECT ENVIRONMENT:
   cd /home/pi
   mkdir rover_project
   cd rover_project
   python3 -m venv venv
   source venv/bin/activate

4. INSTALL PYTHON DEPENDENCIES:
   pip install -r requirements.txt

   Individual package installation:
   pip install pyserial==3.5      # Arduino communication
   pip install RPi.GPIO==0.7.1    # GPIO control
   pip install pybluez==0.23      # Bluetooth scanning
   pip install bleak==0.21.1      # Modern Bluetooth LE

5. GPIO CONFIGURATION:
   Motor Driver Connections (BCM pin numbering):
   - Left Motor Forward  (IN1) → GPIO 18
   - Left Motor Reverse  (IN2) → GPIO 19
   - Right Motor Forward (IN3) → GPIO 20
   - Right Motor Reverse (IN4) → GPIO 21

6. SERIAL PORT SETUP:
   Find Arduino port: ls /dev/tty*
   Common ports: /dev/ttyUSB0, /dev/ttyACM0
   
   Add user to dialout group:
   sudo usermod -a -G dialout pi
   
   Reboot after adding to group:
   sudo reboot

7. BLUETOOTH SETUP:
   Enable Bluetooth: sudo systemctl enable bluetooth
   Install dongles in USB ports
   Check dongles: lsusb | grep Bluetooth

8. PERMISSIONS AND SERVICES:
   Grant GPIO access: sudo usermod -a -G gpio pi
   Grant Bluetooth access: sudo usermod -a -G bluetooth pi

RUNNING THE ROVER:

1. MANUAL STARTUP:
   cd /home/pi/rover_project
   source venv/bin/activate
   python3 rover_controller.py

2. AUTO-START SERVICE (Optional):
   Create systemd service file:
   sudo nano /etc/systemd/system/rover.service
   
   [Unit]
   Description=Rover Controller
   After=multi-user.target
   
   [Service]
   Type=simple
   User=pi
   WorkingDirectory=/home/pi/rover_project
   ExecStart=/home/pi/rover_project/venv/bin/python rover_controller.py
   Restart=always
   RestartSec=5
   
   [Install]
   WantedBy=multi-user.target
   
   Enable service:
   sudo systemctl daemon-reload
   sudo systemctl enable rover.service
   sudo systemctl start rover.service

TESTING AND VALIDATION:

1. ARDUINO CONNECTION TEST:
   python3 -c "import serial; print(serial.Serial('/dev/ttyUSB0', 115200))"

2. GPIO TEST:
   python3 -c "import RPi.GPIO as GPIO; GPIO.setmode(GPIO.BCM); print('GPIO OK')"

3. BLUETOOTH TEST:
   python3 -c "import bluetooth; print(bluetooth.discover_devices())"

4. SERIAL DATA TEST:
   python3 -c "
   import serial, json
   ser = serial.Serial('/dev/ttyUSB0', 115200, timeout=1)
   data = ser.readline().decode().strip()
   print(json.loads(data))
   "

OPERATIONAL MODES:

1. MANUAL MODE (CH3 > 500):
   - RC transmitter controls rover directly
   - Forward/reverse via CH1 (throttle)
   - Steering via CH2 (differential steering)

2. AUTONOMOUS MODE (CH3 < 500):
   - Bluetooth RSSI-based navigation
   - Motors stopped until autonomous logic implemented

3. FAILSAFE MODE:
   - Activated when RC signal lost
   - All motors stopped immediately
   - System waits for valid RC signal

MOTOR CONTROL DETAILS:

PWM Frequency: 1000Hz
Speed Range: -100% to +100%
Control Method: Differential steering
- Left Speed = Throttle + Steering
- Right Speed = Throttle - Steering

TROUBLESHOOTING:

Problem: Permission denied on GPIO
Solution: Add user to gpio group, reboot

Problem: Arduino not detected
Solution: Check USB connection, try different port (/dev/ttyACM0)

Problem: Import error for RPi.GPIO
Solution: pip install RPi.GPIO, run on actual Pi hardware

Problem: Bluetooth devices not found
Solution: sudo systemctl restart bluetooth, check USB dongles

Problem: Motors not responding
Solution: Check GPIO connections, verify power supply

LOGGING AND MONITORING:

Log files: Check terminal output for real-time status
Log levels: INFO, WARNING, ERROR
Monitor: RC signal validity, motor commands, system mode

PERFORMANCE SPECIFICATIONS:

Control Loop: 100Hz (10ms intervals)
Serial Baud: 115200
PWM Frequency: 1000Hz
Response Time: <50ms from RC input to motor output

POWER MANAGEMENT:

GPIO pins source limited current - use for signal only
DROK driver powered directly from battery
Pi powered from 5V buck converter
Total Pi power consumption: ~3W

SAFETY FEATURES:

1. Automatic failsafe on signal loss
2. Motor speed limiting and normalization
3. Exception handling with motor stop
4. Connection monitoring and recovery
5. Clean shutdown procedures

NEXT STEPS:

1. Test manual RC control
2. Implement autonomous navigation
3. Add sensor integration
4. Implement SLAM capabilities
5. Add web interface (optional)

===============================================================================
For questions or issues, refer to project documentation or contact developer.
===============================================================================